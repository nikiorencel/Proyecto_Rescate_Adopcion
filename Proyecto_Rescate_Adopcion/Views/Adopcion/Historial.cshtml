@model IEnumerable<Proyecto_Rescate_Adopcion.Models.Historial>

<link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
<div class="page-solicitudes">
    <div class="solicitudes-card">
        <div class="solicitudes-header">
            <img src="~/Logo.png" alt="" style="width:28px;height:28px;border-radius:8px;">
            <h2 class="solicitudes-title">Rescate y Adopción de Mascotas</h2>
        </div>

        @if (!Model.Any())
        {
            <div class="empty-state">
                <div class="empty-emoji">📋</div>
                <div class="empty-title">Sin actividad reciente</div>
                <div class="empty-sub">El historial de adopciones aparecerá aquí.</div>
            </div>
        }
        else
        {
            <div style="padding: 20px;">
                @foreach (var item in Model)
                {
                    var tiempoTranscurrido = ObtenerTiempoTranscurrido(item.FechaResolucion);
                    var accion = item.EstadoSolicitud == "Aceptada"
                    ? $"Voy a adoptar {item.TipoMascota}"
                    : $"No adoptará {item.TipoMascota}";

                    <div style="display: flex; gap: 16px; padding: 16px 0; border-bottom: 1px solid #f4f4f4; align-items: center;">
                        <!-- Avatar/Icono -->
                        <div style="width: 56px; height: 56px; background: linear-gradient(135deg, #ff7a00 0%, #ff914d 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="white">
                                <path d="M12 2C8.5 2 5.5 4.5 5.5 7.5c0 1.8.9 3.4 2.3 4.5C5.3 13.3 3 16.4 3 20v2h18v-2c0-3.6-2.3-6.7-5.8-8-.9-.5-1.7-1.2-2.2-2-.5.8-1.3 1.5-2.2 2-1.4-.6-2.6-1.5-3.5-2.7-.6-1-.9-2.1-.9-3.3 0-2.2 2-4 4.5-4s4.5 1.8 4.5 4c0 1.2-.3 2.3-.9 3.3-.9 1.2-2.1 2.1-3.5 2.7z" />
                            </svg>
                        </div>

                        <!-- Información -->
                        <div style="flex: 1;">
                            <div style="font-weight: 700; font-size: 16px; margin-bottom: 4px;">
                                @item.NombreUsuario
                            </div>
                            <div style="color: #666; font-size: 14px;">
                                @accion
                                @if (!string.IsNullOrEmpty(item.NombreMascota))
                                {
                                    <span> - <strong>@item.NombreMascota</strong></span>
                                }
                            </div>
                        </div>

                        <!-- Tiempo -->
                        <div style="color: #999; font-size: 14px; text-align: right; white-space: nowrap;">
                            @tiempoTranscurrido
                        </div>
                    </div>
                }
            </div>
        }
    </div>
</div>

@functions {
    private string ObtenerTiempoTranscurrido(DateTime fecha)
    {
        var diferencia = DateTime.Now - fecha;

        if (diferencia.TotalMinutes < 1)
            return "hace un momento";

        if (diferencia.TotalMinutes < 60)
        {
            var minutos = (int)diferencia.TotalMinutes;
            return $"{minutos} {(minutos == 1 ? "minuto" : "minutos")}";
        }

        if (diferencia.TotalHours < 24)
        {
            var horas = (int)diferencia.TotalHours;
            return $"{horas} {(horas == 1 ? "hora" : "horas")}";
        }

        if (diferencia.TotalDays < 30)
        {
            var dias = (int)diferencia.TotalDays;
            return $"{dias} {(dias == 1 ? "día" : "días")}";
        }

        if (diferencia.TotalDays < 365)
        {
            var meses = (int)(diferencia.TotalDays / 30);
            return $"{meses} {(meses == 1 ? "mes" : "meses")}";
        }

        var años = (int)(diferencia.TotalDays / 365);
        return $"{años} {(años == 1 ? "año" : "años")}";
    }
}