@model Proyecto_Rescate_Adopcion.Models.Usuario

@{
    ViewData["Title"] = $"Perfil de {Model.Nombre} {Model.Apellido}";
    Layout = "_Layout";
    var mascotas = ViewBag.Mascotas as List<Proyecto_Rescate_Adopcion.Models.Animal> ?? new List<Proyecto_Rescate_Adopcion.Models.Animal>();
    var adopcionesExitosas = ViewBag.AdopcionesExitosas as int? ?? 0;
}

<link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />

<div class="container" style="max-width:980px;margin:24px auto;">
    <div class="solicitudes-card">
        <!-- Header del perfil -->
        <div class="solicitudes-header" style="border-bottom: 2px solid #f2f2f2;">
            <div style="width: 64px; height: 64px; background: linear-gradient(135deg, #ff7a00 0%, #ff914d 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                <svg width="36" height="36" viewBox="0 0 24 24" fill="white">
                    <path d="M12 2C8.5 2 5.5 4.5 5.5 7.5c0 1.8.9 3.4 2.3 4.5C5.3 13.3 3 16.4 3 20v2h18v-2c0-3.6-2.3-6.7-5.8-8-.9-.5-1.7-1.2-2.2-2-.5.8-1.3 1.5-2.2 2-1.4-.6-2.6-1.5-3.5-2.7-.6-1-.9-2.1-.9-3.3 0-2.2 2-4 4.5-4s4.5 1.8 4.5 4c0 1.2-.3 2.3-.9 3.3-.9 1.2-2.1 2.1-3.5 2.7z" />
                </svg>
            </div>
            <div>
                <h2 class="solicitudes-title" style="margin-bottom: 4px;">@Model.Nombre @Model.Apellido</h2>
                <p style="margin: 0; color: #777; font-size: 15px;">Rescatista</p>
            </div>
        </div>

        <!-- Información del perfil -->
        <div style="padding: 24px;">
            <!-- Estadísticas -->
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 24px;">
                <div style="text-align: center; padding: 16px; background: #f8f9fa; border-radius: 12px;">
                    <div style="font-size: 28px; font-weight: 800; color: #ff7a00;">@mascotas.Count</div>
                    <div style="font-size: 13px; color: #666; font-weight: 600;">Mascotas publicadas</div>
                </div>
                <div style="text-align: center; padding: 16px; background: #f8f9fa; border-radius: 12px;">
                    <div style="font-size: 28px; font-weight: 800; color: #28a745;">@adopcionesExitosas</div>
                    <div style="font-size: 13px; color: #666; font-weight: 600;">Adopciones exitosas</div>
                </div>
                <div style="text-align: center; padding: 16px; background: #f8f9fa; border-radius: 12px;">
                    <div style="font-size: 28px; font-weight: 800; color: #666;">
                        @(mascotas.Count(m => m.Estado == "Disponible"))
                    </div>
                    <div style="font-size: 13px; color: #666; font-weight: 600;">Disponibles ahora</div>
                </div>
            </div>

            <!-- Información de contacto -->
            <div style="background: #fff; border: 1px solid #eee; border-radius: 12px; padding: 20px; margin-bottom: 24px;">
                <h3 style="margin: 0 0 16px; font-size: 18px; font-weight: 800; color: #333;">Información de contacto</h3>

                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                    <div style="width: 40px; height: 40px; background: #fff0e6; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                        <span style="font-size: 20px;">📧</span>
                    </div>
                    <div>
                        <div style="font-size: 12px; color: #999; font-weight: 600;">Email</div>
                        <div style="font-weight: 600; color: #333;">@Model.Email</div>
                    </div>
                </div>

                @if (!string.IsNullOrEmpty(Model.Localidad))
                {
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div style="width: 40px; height: 40px; background: #fff0e6; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <span style="font-size: 20px;">📍</span>
                        </div>
                        <div>
                            <div style="font-size: 12px; color: #999; font-weight: 600;">Localidad</div>
                            <div style="font-weight: 600; color: #333;">@Model.Localidad</div>
                        </div>
                    </div>
                }
            </div>

            <!-- Mascotas publicadas -->
            <div>
                <h3 style="margin: 0 0 16px; font-size: 18px; font-weight: 800; color: #333;">Mascotas publicadas</h3>

                @if (!mascotas.Any())
                {
                    <div class="empty-state">
                        <div class="empty-emoji">🐾</div>
                        <div class="empty-title">Sin mascotas publicadas</div>
                        <div class="empty-sub">Este rescatista aún no ha publicado mascotas.</div>
                    </div>
                }
                else
                {
                    <div class="grid" style="grid-template-columns: repeat(3, 1fr);">
                        @foreach (var mascota in mascotas)
                        {
                            <article class="card">
                                <img src="@(string.IsNullOrWhiteSpace(mascota.FotoUrl) ? Url.Content("~/placeholder.jpg") : mascota.FotoUrl)"
                                     alt="@mascota.NombreAnimal" />
                                <div class="card-body">
                                    <p class="name">@mascota.NombreAnimal</p>
                                    <p class="meta">@mascota.Especie - @mascota.Localidad</p>
                                    <p class="meta">
                                        @(mascota.Edad == null ? "Edad desconocida" :
                                                                        mascota.Edad == 1 ? "1 año" : $"{mascota.Edad} años")
                            </p>

                            @if (mascota.Estado == "Pendiente")
                                    {
                                        <span class="badge badge--pendiente" style="margin-bottom:8px;display:inline-block;">
                                            Con solicitudes
                                        </span>
                                    }
                                    else if (mascota.Estado == "Adoptado")
                                    {
                                        <span class="badge badge--aprobada" style="margin-bottom:8px;display:inline-block;">
                                            Adoptado
                                        </span>
                                    }
                                    else if (mascota.Estado == "Disponible")
                                    {
                                        <span class="badge" style="background: #e8f5e9; color: #2e7d32; margin-bottom:8px;display:inline-block;">
                                            Disponible
                                        </span>
                                    }
                                </div>
                                <a asp-controller="Animal" asp-action="Details" asp-route-id="@mascota.IdSolicitud" class="link-detalle">
                                    Ver detalles
                                </a>
                            </article>
                        }
                    </div>
                }
            </div>

            <!-- Botón volver -->
            <div style="margin-top: 24px; text-align: center;">
                <a onclick="history.back()" class="btn" style="background:#bbb;color:#222;display:inline-block;cursor:pointer;">
                    Volver
                </a>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <style>
        @@media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr !important;
            }

            div[style*="grid-template-columns: repeat(3, 1fr)"] {
                grid-template-columns: 1fr !important;
            }
        }
    </style>
}